option_settings:
  aws:elasticbeanstalk:container:python:
    WSGIPath: config/wsgi.py  # adjust if your WSGI file is elsewhere

  # Tell EB to serve static files automatically
  aws:elasticbeanstalk:environment:proxy:staticfiles:
    /static/: staticfiles/

container_commands:
  # 01: Run migrations (only on leader instance)
  01_migrate:
    command: >
      export $(/opt/elasticbeanstalk/bin/get-config environment | jq -r
      'to_entries|map("\(.key)=\(.value|tostring)")|.[]') &&
      python manage.py migrate --noinput
    leader_only: true

  # 02: Collect static files
  02_collectstatic:
    command: "python manage.py collectstatic --noinput"
    leader_only: true
